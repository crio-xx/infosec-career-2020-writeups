# Про почту
#### Человеку по имени Лаки удалось найти способ попасть на короткий промежуток времени в будущее. Оказавшись в будущем, он наткнулся в интернете на статью о "счастливом билете" в прошедшей недавно лотерее он решил немедленно передать его номер себе в прошлое. 
#### Ему было известно, что вернувшись назад он забудет всё что происходило с ним в будущем, поэтому решил отправить номер билета себе на секретную почту.
#### Вернувшись назад, он обнаружил, что по необъяснимым причинам в прошлое вместе с настоящим письмом пришло еще несколько фальшивых. 
#### Так же, по счастливой случайности, ему удалось вспомнить почтовый адрес с которого он отправил себе письмо - lucky.b000y@infosec-career.tk. 
#### Проблема заключалась в том, что своими силами Лаки не может отличить фальшивые письма от настоящего, поэтому он решил обратиться к специалисту.
#### Специалист должен, по его мнению, уметь разбираться в заголовках электронных писем, а так же обладать знаниями о SPF, DKIM, DMARC.
#### Задание:
    1) Помогите "Счастливчику" найти настоящее письмо. Напишите номер выигрышного билета.
    2) Объясните для каждого письма как вы определяли, что оно настоящее/фальшивое.
    3) Взгляните на SPF запись домена infosec-career.tk. Можно ли считать данный вариант ненадежным? Если да, то почему?
    4) Какие варианты защиты вы еще можете предложить?
#### Адрес почтового клиента: https://infosec-career.tk/mail Учетная запись: lucky@infosec-career.tk luckyboy1337
----
## Решение
Заходим на почту и видим 4 письма. 

Введем такую нумерацию(по **id**):

    id: time: номер_выигрышного_билета
     1:05-12: 339753
     2:05-17: 11910511
     3:05-20: 484851
     4:05-22: 108111116

***Ответы:***
1) ***108111116***
2) **Анализ писем**
    Открываем исходный код каждого письма, чтобы увидеть заголовки писем. 
      + В письме 1: 

         Видим, что письмо было отправлено с ящика ***@yandex.ru*** (из заголовка **From**), плюс отсутствует логика в заголовках перекладывания (отсутствует последовательная цепочка адресов в заголовках Received, тк последний по хронологии никак не связан с предыдущими) => ***письмо ненастоящее***.

      + В письме 2: 

          Здесь нас настораживает то, что письмо не прошло проверку dkim(из-за отсутствия публичного ключа), а также в первом по хронологии заголовки "перекладывания" письма "Received: from ip-172-31-30-223 (localhost [127.0.0.1]) by mail.izoaz.ru (Postfix) with ESMTPS id 95515824BD", видим, что оно было отправлено с неизвестного адреса => ***письмо фальшивое***.

      + В письме 3: 

           В самом первом заголовке Return-Path: <lucky.b00y@infosec-career.tk> видим в адресе почты только 2 "нуля", что говорит о **поддельности**. (“*Cousin domains/addresses*”)

      + В письме 4: 

           Отсутствуют пререкания, а также методом исключения - это письмо *настоящее*. 
           
      Ответ на первый пункт - **108111116**.

3) **SPF запись домена infosec-career.tk: v=spf1 a mx +all**

    Я считаю эту запись ненадежной, так как "**+all**" указывает, что отправлять письма от имени домена **«infosec-career.tk»** могут сервера, указанные в ***A*** и ***MX***-записях этого домена, а также c любых *IP*-адресов. Это может привести к использованию спаммерами и попаданию под блокировку домена. 
Поэтому, следует изменить запись на "*v=spf1 a mx -all*" или, хотя бы, на  "*v=spf1 a mx ~all*".
**-all** - говорит о том, что письма, не прошедшие верификацию, должны быть отвергнуты, a **~all** - должны быть изучены более тщательной проверке.

4) **Варианты защиты**

   Использовать фильтрацию на основе **DKIM**, проверок **SPF**-записей, **DMARC**, а также проверять *DNS*-записи сервера отправителя (сверять его с заголовками конверта письма).
Так как, проверка на основе **DKIM**, **SPF** и **DMARC** не идеальна, можно прибегнуть к созданию своих фильтров(анализаторов заголовков) или использовать готовые решения, например *Cisco ESA*. Эти меры позволят настроить гранулярные фильтры для отсеивания таких писем, которые были встречены в задании (“*Cousin domains/addresses*” в 3 письме, поддельный заголовок ***From***, прошедший **DKIM** и тд). Эти меры, может не помогут полностью защититься от атак, так как атаки с помощью поддельных писем встречаются каждый день, но существенно снизят вероятность воздействия на человека с помощью социальной инженерии и теоретические утечки информации.

____
##### Score: 8/10
